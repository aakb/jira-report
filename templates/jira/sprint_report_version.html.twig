{% extends 'base.html.twig' %}

{% block body %}
  <div>
    <strong>Projekt: </strong><span>{{ project.name }}</span>
  </div>
  <div>
    <strong>Bestilling: </strong>
    <span>{{ version.name }}</span>
  </div>
  {% if version.description is defined %}
    <div>
      <strong>Beskrivelse: </strong>
      <p>{{ version.description }}</p>
    </div>
  {% endif %}

  <div>
    <strong>Salgsbudget: </strong><input type="number" id="input-budget">
  </div>
  <div>
    <div>
      <strong>Timer reg. total: </strong>
      <span id="time_spent">
        {{ spentHours }}
      </span>
    </div>

    <div>
      <strong>Resterende timer planlagt total: </strong>
      <span id="remaining_hours">
        {{ remainingHours }}
      </span>
    </div>

    <div>
      <strong>Projektets timer: </strong>
      <span id="project_hours">
        {{ spentHours + remainingHours }}
      </span>
    </div>
  </div>
  <div>
    <strong>Færdiggørelsesgrad (%): </strong>
    <input type="number"
           id="input_finished_degree"
           max="100" min="0">
  </div>
  <div>
    <strong>Project total forecast: </strong>
    <span id="project_total_forecast"></span>
  </div>
  <div>
    <strong>Over/underløb - index: </strong>
    <span id="over_under_index"></span>
  </div>


  <div>
    <h3>Projektets faser:</h3>
    <table class="table" style="max-width: 800px;">
      <thead>
      <tr>
        <th>EPIC</th>
        <th>Est.</th>
        <th>Resterende arbejde est.</th>
        <th>Registreret</th>
      </tr>
      </thead>
      <tbody>
      {% for epic in epics %}
        <tr>
          <td>{{ epic.name }}</td>
          <td>{{ epic.originalEstimateSum / 60 / 60 }}</td>
          <td>{{ epic.remainingSum / 60 / 60 }}</td>
          <td>{{ epic.spentSum / 60 / 60 }}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
{% endblock %}

{% block javascripts %}
  {{ parent() }}

  <script type="text/javascript">
      (function() {
          function updateNumbers (){
              var remainingHours = parseFloat(document.querySelector('#remaining_hours').innerHTML);
              var finishedDegree = parseFloat(document.querySelector('#input_finished_degree').value);
              var sales_budget = parseFloat(document.querySelector('#input-budget').value);

              var forecast = null;
              var over_under = null;

              if (finishedDegree > 0) {
                  forecast = remainingHours / finishedDegree * 100;

                  document.querySelector('#project_total_forecast').innerHTML = "" + forecast.toFixed(2);
              }

              if (sales_budget > 0 && forecast != null) {
                  over_under = forecast / sales_budget;

                  document.querySelector('#over_under_index').innerHTML = "" + over_under.toFixed(2);
              }
          }

          document.querySelector('#input_finished_degree').addEventListener('blur', updateNumbers);
          document.querySelector('#input-budget').addEventListener('blur', updateNumbers);
      })();
  </script>
{% endblock %}
